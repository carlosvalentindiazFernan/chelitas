<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../../redux-mixin/redux-mixin.html">
<!-- firebase-->
<script src="../../../bower_components/firebase/firebase.js"></script>
<link rel="import" href="../../profile-chelitas/profile-chelitas.html">

<dom-module id="singin-chelitas">
  <template>
      <!--<template is="dom-if" if="[[!user]]">-->
            <style>
              :host {
                display: block;
              }

              #btnfacebook{
                  background: #3F51B5;
                  color: #fff;
              }

              #btngoogle{
                  background: #F44336;
                  color: #fff;
              }

              paper-button{
                  width: 40%;
                  margin-left: 30%;
              }
            </style>
            <firebase-app
              auth-domain="chelitas-24648.firebaseapp.com"
              database-url="https://chelitas-24648.firebaseio.com"
              api-key="AIzaSyDxcYm507yFlbsKtXJNQ7tDjxXf_HIJAR8"
              storage-bucket="chelitas-24648.appspot.com"
              messaging-sender-id="220775801818">
            </firebase-app>
            <firebase-auth
                    id="google"
                    user="{{user}}"
                    status-known="{{statusKnown}}"
                    provider="google">
            </firebase-auth>
            <firebase-auth
                    id="facebook"
                    user="{{user}}"
                    status-known="{{statusKnown}}"
                    provider="facebook">
            </firebase-auth>
            <paper-button raised class="indigo" id="btnfacebook" on-tap="loginFacebook">Facebook</paper-button><br><br>
            <paper-button raised class="indigo" id="btngoogle" on-tap="loginGoogle">Google</paper-button>
        <!--</template>-->
  </template>

  <script>
    (function SinginDefinition(){
        'use strict';


        class SinginChelitas extends ReduxMixin(Polymer.GestureEventListeners(Polymer.Element)) {

            static get is() { return 'singin-chelitas'; }

            static get properties() {
                return {
                    user: {
                        type: Object,
                        statePath: 'currentUser',
                        observer: 'userActive'
                    },
                    isLogged: {
                        type: Boolean,
                        statePath: 'isLogged',
                        observer: 'userInactive'
                    }
                };
            }

            static get actions() {
                return {
                    loginUser(user) {
                        return {
                            type: 'LOGIN_USER',
                            user
                        };
                    },
                    logoutUser(logged) {
                        return {
                            type: 'LOGOUT_USER',
                            logged
                        };
                    }
                };
            }

            connectedCallback(){
                super.connectedCallback();
            }
            loginFacebook(){
                this.$.facebook.signInWithPopup()
                .then(function(response) {
                    return response;
                })
                .catch(function(error) {
                    console.log("error in login facebook");
                });
            }
            loginGoogle(){
                this.$.google.signInWithPopup()
                .then(function(response) {
                    return response;
                })
                .catch(function(error) {
                    console.log("error in login google");
                });
            }

            userActive(){
                console.log("userActive object user: "+this.user);
                if(this.user){
                    this.dispatch('loginUser', this.user);
                } else {
                    console.log("error in dispatch loginUser");
                }
            }
            userInactive(){
                console.log("userInactive object user: "+this.user);
                if(!this.isLogged){
                    this.dispatch('logoutUser', false);
                } else {
                    this.dispatch('loginUser', this.user);
                }
            }
        }

        window.customElements.define(SinginChelitas.is,SinginChelitas);
    })();
  </script>
</dom-module>

<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<!-- firebase-->
<script src="../../../bower_components/firebase/firebase.js"></script>


<dom-module id="singin-chelitas">
  <template>
    <style>
      :host {
        display: block;
      }

      #btnfacebook{
          background: #3F51B5;
          color: #fff;
      }

      #btngoogle{
          background: #F44336;
          color: #fff;
      }

      paper-button{
          width: 40%;
          margin-left: 30%;
      }
    </style>
    <paper-button raised class="indigo" id="btnfacebook" on-tap="signFacebook">Facebook</paper-button><br><br>
    <paper-button raised class="indigo" id="btngoogle" on-tap="signGoogle">Google</paper-button>
  </template>

  <script>
    (function SinginDefinition(){
        'use strict';


        class SinginChelitas extends ReduxMixin(Polymer.GestureEventListeners(Polymer.Element)) {

            static get is() { return 'singin-chelitas'; }

            static get properties() {
                return {
                    login: {
                        type: String,
                        observer: '_signin'
                    },
                    firebaseConfig:{
                        type: Object,
                        statePath: 'config'
                    }
                };
            }

            static get actions() {
                return {
                    loginUser(user) {
                        return {
                            type: 'LOGIN_USER',
                            user
                        };
                    }
                };
            }

            connectedCallback(){
                super.connectedCallback();
                firebase.initializeApp(this.firebaseConfig);
            }

            signFacebook(){
                this.login = "Facebook";
            }

            signGoogle(){
                this.login = "Google";
            }

            _signin(){
                console.log(this.login);
                switch (this.login){
                    case "Facebook":
                        this._signinfacebook();
                    case "Google":
                        this._signingoogle();
                    default:
                }
            }

            _signingoogle(){
                let provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('https://www.googleapis.com/auth/contacts.readonly');
                firebase.auth().signInWithPopup(provider).then(function(result) {
                    let token = result.credential.accessToken;
                    let secret = result.credential.secret;
                    let user = result.user;
                    if(user){
                        this.dispatch('loginUser',user);
                    }
                }).catch(function(error) {
                    let errorCode = error.code;
                    let errorMessage = error.message;
                    let email = error.email;
                    let credential = error.credential;
                    console.log(error);
                });
            }

            _signinfacebook(){
                let provider = new firebase.auth.FacebookAuthProvider();
                firebase.auth().signInWithPopup(provider).then(function(result) {
                    let token = result.credential.accessToken;
		            let secret = result.credential.secret;
                    let user = result.user;
                    if(user){
                        this.dispatch('loginUser',user);
                    }
                }).catch(function(error) {
                    let errorCode = error.code;
		            let errorMessage = error.message;
            		let email = error.email;
            		let credential = error.credential;
            		console.log(credential);
            	});
            }
        }

        window.customElements.define(SinginChelitas.is,SinginChelitas);
    })();
  </script>
</dom-module>
